<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .chat-container {
            width: 95%;
            max-width: 800px;
			max-height: 900px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .input-container input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .chat-box {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            max-height: 1024px;
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 20px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .message.user {
            background-color: #e1ffc7;
            align-self: flex-end;
        }
        .message.gpt {
            background-color: #e0e0e0;
        }
        .button-container {
            display: flex;
			gap: 10px; /* ë‘ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²©ì„ 10pxë¡œ ì„¤ì • */
            justify-content: center;
        }
        .button-container button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
        }
		.hidden {
            display: none;
        }
    </style>
</head>
<body>
	<!--ip, port ì •ë³´ë¥¼ ìˆ¨ê¹€-->
	<p id="hostname" class="hidden"></p>
	<p id="port" class="hidden"></p>

    <div class="chat-container">
        <div class="input-container">
		    <span class="userId">ğŸ§’ ì‚¬ìš©ì ID: {{ user_id[:35] }}</span>
            <input type="hidden" id="userId" placeholder="Enter your User ID" value="{{user_id}}">
            <input type="text" id="userQuestion" placeholder="Enter your question">
        </div>
		<div class="button-container">
			<button id="searchBtn">ê²€ìƒ‰</button>
            <button id="newChatBtn">ê²€ìƒ‰ëª©ë¡ ì´ˆê¸°í™”</button>
        </div>
		<br>
        <div class="chat-box" id="chatBox"></div>
    </div>

	<script>
        window.onload = function() {

            // URLì˜ ë„ë©”ì¸ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            var hostname = window.location.hostname;

            // URLì˜ í¬íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            var port = window.location.port;

            // ê²°ê³¼ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.
            console.log("Hostname: " + hostname);
            console.log("Port: " + port);

            // ê²°ê³¼ë¥¼ HTMLì— í‘œì‹œí•©ë‹ˆë‹¤.
            document.getElementById("hostname").textContent = hostname;
            document.getElementById("port").textContent = port;
        };
    </script>
    <script>
       async function handleSearch() {
			const hostname = document.getElementById("hostname").textContent;
			const port = document.getElementById("port").textContent;
			const userId = document.getElementById('userId').value;
			const userQuestion = document.getElementById('userQuestion').value;
			if (!userId || !userQuestion) return;

			// Add user question to chat box
			const userMessage = document.createElement('div');
			userMessage.classList.add('message', 'user');
			userMessage.textContent = `${userId}: ${userQuestion}`;
			document.getElementById('chatBox').appendChild(userMessage);

			// Clear the question input
			document.getElementById('userQuestion').value = '';

			try {
				// Simulate sending the question to GPT and getting a response
				// 3ê°€ì§€ ê°’ = ì‘ë‹µê²°ê³¼, ê²€ìƒ‰ê²°ê³¼, ì—ëŸ¬ì½”ë“œ ë¦¬í„´ë¨.
				const gptResponse = await getGptResponse(userId, userQuestion, hostname, port);

				// Add GPT response to chat box and display it character by character
				const gptMessage = document.createElement('div');
				gptMessage.classList.add('message', 'gpt');
				document.getElementById('chatBox').appendChild(gptMessage);

				gptMessage.innerHTML = 'AI:<br>';
				gptMessage.innerHTML += gptResponse[0] + ' <button class="view-more">ë‚´ìš©ë³´ê¸°</button><br>';

				const searchContent = document.createElement('div');
				searchContent.classList.add('search-content');
				searchContent.style.display = 'none';
				searchContent.innerHTML = gptResponse[1] + '<br>';

				document.getElementById('chatBox').appendChild(gptMessage);
				document.getElementById('chatBox').appendChild(searchContent);

				gptMessage.querySelector('.view-more').addEventListener('click', function() {
					if (searchContent.style.display === 'none') {
						searchContent.style.display = 'block';
						this.textContent = 'ë‚´ìš©ìˆ¨ê¸°ê¸°';
					} else {
						searchContent.style.display = 'none';
						this.textContent = 'ë‚´ìš©ë³´ê¸°';
					}
				});

			} catch (error) {
				console.error('Error fetching GPT response:', error);
			}

			// Scroll to the bottom of the chat box
			document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
		}

        async function getGptResponse(userId, question, hostname, port) {
			
			const url = `/search/query?user_id=${encodeURIComponent(userId)}&query=${encodeURIComponent(question)}`; //*ì•ì— url ë¶™ì¼í•„ìš”ì—†ì´ /ê²½ë¡œë§Œ ì ì–´ì£¼ë©´ ë¨.
            let response = await fetch(url);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            data = await response.json();
            return data
        }

		document.getElementById('userQuestion').addEventListener('keydown', function(event) {
			if (event.key === 'Enter') {
				handleSearch();
			}
		});

		document.getElementById('searchBtn').addEventListener('click', handleSearch);

        document.getElementById('newChatBtn').addEventListener('click', function() {
            // Clear the chat box
            document.getElementById('chatBox').innerHTML = '';
        });
    </script>
</body>
</html>



